<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador de Manzanas por Colonia | SEDEMA CDMX</title>

  <link href="styles.css" rel="stylesheet" />

  <!-- Select2 -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <!-- Fuente Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>

<header>
  <h1>SEDEMA · Buscador de Manzanas por Colonia</h1>
  <div class="linea-oro"></div>
</header>

<div class="container">

  <h2>Consulta por alcaldía y colonia</h2>

  <div class="form-row">
    <label for="munSelector">Alcaldía:</label>
    <select id="munSelector" style="width:100%"></select>
  </div>

  <div class="form-row">
    <label for="colSelector">Colonia:</label>
    <select id="colSelector" style="width:100%"></select>
  </div>

  <div id="resultado" class="resultado" style="display:none;"></div>

</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
let datos = [];
let municipios = [];

// Cargar CSV
fetch('manzanas_por_colonia.csv')
  .then(resp => resp.text())
  .then(texto => {
    const lineas = texto.split(/\r?\n/).map(l => l.trim()).filter(l => l.length > 0);

    // Saltar encabezado
    datos = lineas.slice(1).map((l, idx) => {
      const cols = l.split(",");
      return {
        index: idx,
        MUN_NAME: cols[0],
        SETT_NAME: cols[1],
        SETT_TYPE: cols[2],
        CP: cols[3],
        MANZANAS: cols[4]
      };
    });

    // Lista única de alcaldías
    municipios = [...new Set(datos.map(d => d.MUN_NAME))]
      .sort((a,b) => a.localeCompare(b, 'es'));

    const $mun = $('#munSelector');
    $mun.append(new Option('', '', true, true)); // placeholder

    municipios.forEach(m => {
      $mun.append(new Option(m, m));
    });

    $mun.select2({
      placeholder: 'Selecciona una alcaldía…',
      allowClear: true
    });

    $('#colSelector').select2({
      placeholder: 'Primero selecciona una alcaldía…',
      allowClear: true
    });
  });

// Cambio de alcaldía
$('#munSelector').on('change', function() {
  const mun = $(this).val();
  const $col = $('#colSelector');
  $col.empty().trigger('change');
  $('#resultado').hide();

  if (!mun) {
    $col.select2({
      placeholder: 'Primero selecciona una alcaldía…',
      allowClear: true
    });
    return;
  }

  // Filtrar colonias de la alcaldía seleccionada
  const colonias = datos
    .filter(d => d.MUN_NAME === mun)
    .sort((a,b) => a.SETT_NAME.localeCompare(b.SETT_NAME, 'es'));

  $col.append(new Option('', '', true, true)); // placeholder

  colonias.forEach(d => {
    const text = `${d.SETT_NAME} (CP ${d.CP})`;
    $col.append(new Option(text, d.index));
  });

  $col.select2({
    placeholder: 'Selecciona una colonia…',
    allowClear: true
  });
});

// Cambio de colonia
$('#colSelector').on('change', function() {
  const idx = $(this).val();
  if (idx === null || idx === '') {
    $('#resultado').hide();
    return;
  }

  const d = datos[parseInt(idx, 10)];

  const html =
    `<div class='card'>
        <p><b>Alcaldía:</b> ${d.MUN_NAME}</p>
        <p><b>Colonia:</b> ${d.SETT_NAME}</p>
        <p><b>Tipo:</b> ${d.SETT_TYPE}</p>
        <p><b>Código Postal:</b> ${d.CP}</p>
        <h3>Número de manzanas: <span class='numero'>${d.MANZANAS}</span></h3>
     </div>`;

  $('#resultado').html(html).show();
});
</script>

</body>
</html>
